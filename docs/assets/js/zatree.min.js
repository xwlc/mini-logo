// SPDX-License-Identifier: GPL-3.0-only OR Apache-2.0 OR MIT
// SPDX-FileCopyrightText: 2024 Charles Wong <charlie-wong@outlook.com>
// Created By: Charles Wong 2024-07-07T02:58:21+08:00 Asia/Shanghai
// Repository: https://github.com/xwlc/xwlc.github.io
class ZATree{static randomInteger(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}static#e=Math.PI/2;static#t(){const e=1-Math.random(),t=1-Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}static#r(){return class{constructor(e,t,r,a){this.x=e,this.y=t,this.r=r,this.a=a}step(e,t,r){this.r-=r.diminish,this.x+=Math.cos(this.a)*r.stepSize,this.y+=Math.sin(this.a)*r.stepSize,this.a+=ZATree.#t()*r.angleMax*Math.pow(1+(e+t-this.r)/t,r.angleExp)}draw(e,t,r){const a=[Math.cos(this.a+ZATree.#e),Math.sin(this.a+ZATree.#e)],i=[Math.cos(this.a-ZATree.#e),Math.sin(this.a-ZATree.#e)],n=e=>e*this.r*r.zmin,l=a.map(n),o=i.map(n),s=(t,r)=>e.fillRect(t,r,1,1),h=(e,t,r)=>{const a=Math.hypot(e,t);for(let i=0;i<=r;i++){const r=n(a*Math.random()*Math.random()-1);s(e*r,t*r)}};e.save(),e.translate(this.x*r.width,this.y*r.height),e.beginPath(),e.moveTo(...l),e.lineTo(...o),e.stroke(),e.closePath();const d={L:t.dots*t.density[0],R:t.dots*t.density[1]};s(...l),h(...a,d.L),s(...o),h(...i,d.R),e.restore()}}}static#a(){return class{constructor(e,t,r,a,i,n){this.x=e,this.y=t,this.r=i.init,this.branch=r,this.rect=n,this.pixel=1/n.zmin,this.grain=a,this.dice=i.dice,this.Q=[new(ZATree.#r())(e,t,i.init,-ZATree.#e)]}step(){for(let e=this.Q.length-1;e>=0;--e){const t=this.Q[e];t.step(this.pixel,this.r,this.branch.delta),t.r<=this.pixel?this.Q.splice(e,1):Math.random()<this.r-t.r+this.dice&&this.Q.push(new(ZATree.#r())(t.x,t.y,t.r*this.branch.dense,t.a+this.branch.angle*(2*Math.random()-1)))}}draw(e){for(const t of this.Q)t.draw(e,this.grain,this.rect)}}}static#i(e,t){"number"!=typeof t&&(t=32);const r=ZATree.randomInteger(10,50),a=ZATree.randomInteger(10,50)/1e3;let i,n=e.width;return e.height<e.width&&(n=e.height),i=1/n,{lineWidth:2,lineColor:"black",fillColor:"white",root:{x:.5,y:1},rect:{width:e.width,height:e.height,zmin:n},branch:{dense:.725,angle:Math.PI/4,delta:{stepSize:i,diminish:i/t,angleExp:2,angleMax:4*Math.PI/n}},grain:{dots:Math.ceil(n*a),density:[.18,.55]},ctrl:{init:1/t,dice:i*i*t*r}}}static draw(e,t={},r){if(!e||!e.getContext)throw new Error("Could not get HTML <canvas> element");t={...ZATree.#i(e,t.magic),...t};const a=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],i=e.getContext("2d");if(i.lineWidth=t.lineWidth,t.randomColor){const e=ZATree.randomInteger(0,a.length-1),t=ZATree.randomInteger(0,a.length-1);i.fillStyle=a[e],i.strokeStyle=a[t]}else i.fillStyle=t.lineColor,i.strokeStyle=t.fillColor;const n=new(ZATree.#a())(t.root.x,t.root.y,t.branch,t.grain,t.ctrl,t.rect);!function t(){n.Q.length>0?(n.step(),n.draw(i),window.requestAnimationFrame(t)):"function"==typeof r&&r(ZATree.base64(e))}()}static base64(e,t="jpeg",r=.98){if(!e||!e.getContext)throw new Error("Could not get HTML <canvas> element");if("png"==t)return e.toDataURL();t&&/^jpeg|webp$/.test(t)||(t="jpeg"),(!r||r<=0||r>=1)&&(r=.98);const a=e.toDataURL("image/"+t,r);return"webp"==t&&0!=a.indexOf("data:image/webp")?e.toDataURL("image/jpeg",r):a}}
